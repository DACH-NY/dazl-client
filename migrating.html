<!DOCTYPE html>
<html lang="" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Migrate</title>
  

  <link rel="apple-touch-icon" sizes="180x180" href="_static/apple-touch-icon.png"/>
  <link rel="icon" type="image/png" href="_static/favicon-32x32.png" sizes="32x32"/>
  <link rel="icon" type="image/png" href="_static/favicon-16x16.png" sizes="16x16"/>
  <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="dazl 7.11.0 documentation" href="index.html"/>
        <link rel="next" title="dazl package" href="dazl.html"/>
        <link rel="prev" title="Testing" href="testing.html"/> 
</head>
<body>

   

  <header>
    dazl

  </header>
  <nav>
              
              
                
              
              
                <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Migrate</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#migrating-to-the-daml-python-bindings-v7-5">Migrating to the Daml Python bindings v7.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#command-submission-changes-dazl-network-and-dazl-connect">Command submission changes (<code class="docutils literal notranslate"><span class="pre">dazl.Network</span></code> and <code class="docutils literal notranslate"><span class="pre">dazl.connect</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-line-changes">Command-line changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#migrating-to-the-daml-python-bindings-v7">Migrating to the Daml Python bindings v7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#template-formats">Template formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sandbox-wrapper">Sandbox Wrapper</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-model-changes">Time Model changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deprecated-symbols-removal">Deprecated symbols removal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#migrating-to-v6">Migrating to v6</a></li>
<li class="toctree-l2"><a class="reference internal" href="#migrating-to-v5">Migrating to v5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#library-initialization">Library Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initialization-event-listeners">Initialization Event Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ready-event-listeners">Ready Event Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-archive-event-listeners">Create/Archive Event Listeners</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dazl.html">dazl package</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

              

  </nav>
  <main>
    
  <section id="migrate">
<h1>Migrate<a class="headerlink" href="#migrate" title="Permalink to this headline">¶</a></h1>
<section id="migrating-to-the-daml-python-bindings-v7-5">
<h2>Migrating to the Daml Python bindings v7.5<a class="headerlink" href="#migrating-to-the-daml-python-bindings-v7-5" title="Permalink to this headline">¶</a></h2>
<p>The Daml Python bindings v7.5.0 introduces a new API, <code class="docutils literal notranslate"><span class="pre">dazl.connect</span></code> for adding support to more modern features of
Daml Connect. The <code class="docutils literal notranslate"><span class="pre">dazl.Network</span></code> API will continue to be supported in the Daml Python bindings v8 (the next major
version of the Daml Python bindings), but you are encouraged to use <code class="docutils literal notranslate"><span class="pre">dazl.connect</span></code> going forward.</p>
<p><code class="docutils literal notranslate"><span class="pre">dazl.connect</span></code> embraces design patterns and technical capabilities that have been introduced to
Daml and some of the underlying Python libraries over the last few years.</p>
<ul>
<li><p>Daml Multi-party submissions (as of Daml Connect 1.9):
<a class="reference external" href="https://daml.com/blog/engineering/roles-in-daml-introducing-multi-party-submissions/">https://daml.com/blog/engineering/roles-in-daml-introducing-multi-party-submissions/</a></p>
<p>Occasionally it had been necessary for applications to listen to multiple streams as different
parties and submit commands based on information. With multi-party submissions, relationships
such as public information and group membership is easier to model with parties, which removes
the need for clients to attempt to keep otherwise independent streams correlated. As such,
<a class="reference internal" href="dazl.html#dazl.Network" title="dazl.Network"><code class="xref py py-class docutils literal notranslate"><span class="pre">dazl.Network</span></code></a> is deprecated in favor of a lighterweight API that is more explicitly
focused on single connections.</p>
</li>
<li><p>Daml HTTP JSON API (stable as of DAML SDK 1.3.0)</p>
<p>While not yet directly supported (this is planned for the Daml Python bindings v8.0.0), the HTTP JSON API supports
most use-cases for applications that need to communicate with a ledger. The new API is slightly
restructured for both compatibility with the HTTP JSON API and parity with the JavaScript
<a class="reference external" href="https://www.npmjs.com/package/&#64;daml/ledger">&#64;daml/ledger</a> library.</p>
</li>
<li><p>Daml Authentication/authorization using JSON Web Tokens (JWT)</p>
<p>The Daml Python bindings were originally built with the simple assumption that a <code class="docutils literal notranslate"><span class="pre">Party</span></code> exists 1:1 to a set of
credentials. As the Daml Ledger API evolved, this assumption no longer holds. The new Daml Python bindings API
treats tokens more opaquely, and removes the assumption that connections are tied to a specific single <code class="docutils literal notranslate"><span class="pre">Party</span></code>.</p>
</li>
<li><p>Daml return values from exercise choices</p>
<p>Exercise return values have been available from the Ledger API since Daml was open sourced back
in April 2019. The Daml Python bindings’s API has finally been updated to take this feature into account.</p>
</li>
<li><p>“Unsubscribing” from streams</p>
<p>The Daml Python bindings have never had a straightforward way of abandoning event callbacks that were no longer
needed. The new API makes stream lifecycle more explicit and the responsibility of the user of the
library. Disposing of streams is now simpler to reason about.</p>
</li>
<li><p>Native gRPC support for asyncio: <a class="reference external" href="https://github.com/grpc/proposal/pull/155">https://github.com/grpc/proposal/pull/155</a></p>
<p>As of gRPC 1.32.0, the Python gRPC libraries natively support <code class="docutils literal notranslate"><span class="pre">asyncio</span></code>. This, combined with
client streams that are no longer coupled to each other, means the internals of the Daml Python bindings are
significantly simpler while also improving performance.</p>
</li>
</ul>
<section id="command-submission-changes-dazl-network-and-dazl-connect">
<h3>Command submission changes (<code class="docutils literal notranslate"><span class="pre">dazl.Network</span></code> and <code class="docutils literal notranslate"><span class="pre">dazl.connect</span></code>)<a class="headerlink" href="#command-submission-changes-dazl-network-and-dazl-connect" title="Permalink to this headline">¶</a></h3>
<p>The most visible change from trying to align the Daml Python bindings to the
<a class="reference external" href="https://www.npmjs.com/package/&#64;daml/ledger">&#64;daml/ledger</a> library is a renaming of the properties
of the <code class="docutils literal notranslate"><span class="pre">Command</span></code> class hierarchy.</p>
<p>In general, however, you should prefer the command submission
methods on either <a class="reference internal" href="dazl.ledger.html#dazl.ledger.Connection" title="dazl.ledger.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">dazl.ledger.Connection</span></code></a> or <code class="docutils literal notranslate"><span class="pre">dazl.client.PartyClient</span></code>, as these methods
give you access to command-specific return values, such as exercise results for
<a class="reference internal" href="dazl.ledger.html#dazl.ledger.CreateAndExerciseCommand" title="dazl.ledger.CreateAndExerciseCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">dazl.ledger.CreateAndExerciseCommand</span></code></a>, <a class="reference internal" href="dazl.ledger.html#dazl.ledger.ExerciseCommand" title="dazl.ledger.ExerciseCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">dazl.ledger.ExerciseCommand</span></code></a>, and
<a class="reference internal" href="dazl.ledger.html#dazl.ledger.ExerciseByKeyCommand" title="dazl.ledger.ExerciseByKeyCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">dazl.ledger.ExerciseByKeyCommand</span></code></a>; or information about the created contract
(<a class="reference internal" href="dazl.ledger.html#dazl.ledger.CreateCommand" title="dazl.ledger.CreateCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">dazl.ledger.CreateCommand</span></code></a>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Avoid:</span>
<span class="kn">from</span> <span class="nn">dazl</span> <span class="kn">import</span> <span class="n">exercise</span>
<span class="c1"># This method does not return anything meaningful</span>
<span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">exercise</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;SomeChoice&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">}))</span>

<span class="c1"># Instead (v7.5 and later):</span>
<span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">exercise</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;SomeChoice&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">}))</span>
<span class="c1"># This is the result of exercising the choice;</span>
<span class="c1"># available only when using specific command submission methods</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>If you still have a use-case for constructing commands (for example, batch submission), the change
to your code should be as simple as changing imports:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Old imports</p></th>
<th class="head"><p>New import</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.CreateCommand</span></code>
<code class="docutils literal notranslate"><span class="pre">dazl.create(...)</span></code>
<code class="docutils literal notranslate"><span class="pre">dazl.model.writing.CreateCommand</span></code></p></td>
<td><p>:class:<code class="docutils literal notranslate"><span class="pre">dazl.ledger.CreateCommand</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.CreateAndExerciseCommand</span></code>
<code class="docutils literal notranslate"><span class="pre">dazl.create_and_exercise</span></code>
<code class="docutils literal notranslate"><span class="pre">dazl.model.writing.CreateAndExerciseCommand</span></code></p></td>
<td><p>:class:<code class="docutils literal notranslate"><span class="pre">dazl.ledger.CreateAndExerciseCommand</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.ExerciseCommand</span></code>
<code class="docutils literal notranslate"><span class="pre">dazl.exercise(...)</span></code>
<code class="docutils literal notranslate"><span class="pre">dazl.model.writing.ExerciseCommand</span></code></p></td>
<td><p>:class:<code class="docutils literal notranslate"><span class="pre">dazl.ledger.ExerciseCommand</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.ExerciseByKeyCommand</span></code>
<code class="docutils literal notranslate"><span class="pre">dazl.model.writing.ExerciseByKeyCommand</span></code>
<code class="docutils literal notranslate"><span class="pre">dazl.model.writing.create</span></code></p></td>
<td><p>:class:<code class="docutils literal notranslate"><span class="pre">dazl.ledger.ExerciseByKeyCommand</span></code></p></td>
</tr>
</tbody>
</table>
<p>These command classes can and should be used in both the <code class="docutils literal notranslate"><span class="pre">dazl.Network</span></code> API and the
<code class="docutils literal notranslate"><span class="pre">dazl.connect</span></code> API.</p>
<p>The changes:</p>
<p><code class="docutils literal notranslate"><span class="pre">dazl.Network</span></code>, which has been the primary entry point for the Daml Python binding’s code since Daml Python bindings v5, will be
deprecated in the Daml Python bindings v8.0.0. Transitional releases (starting with v7.5.0) will include both APIs, an
<code class="docutils literal notranslate"><span class="pre">dazl.Network</span></code> will be fully removed in the Daml Python bindings v9.0.0.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># dazl v5-v7</span>
<span class="kn">import</span> <span class="nn">dazl</span>

<span class="n">network</span> <span class="o">=</span> <span class="n">dazl</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span>
<span class="n">network</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost:6865&quot;</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">aio_party</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>

<span class="nd">@client</span><span class="o">.</span><span class="n">on_ledger_create</span><span class="p">(</span><span class="s2">&quot;Some:Request&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">auto_accept</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">dazl</span><span class="o">.</span><span class="n">exercise</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;Accept&quot;</span><span class="p">)</span>

<span class="n">network</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>

<span class="c1"># dazl v7.5 or later, transitional API</span>
<span class="kn">import</span> <span class="nn">dazl</span>

<span class="n">network</span> <span class="o">=</span> <span class="n">dazl</span><span class="o">.</span><span class="n">ConnectionFactory</span><span class="p">()</span>
<span class="n">network</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost:6865&quot;</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">aio_party</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>

<span class="nd">@client</span><span class="o">.</span><span class="n">on_ledger_create</span><span class="p">(</span><span class="s2">&quot;Some:Request&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">auto_accept</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">dazl</span><span class="o">.</span><span class="n">exercise</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;Accept&quot;</span><span class="p">)</span>

<span class="n">network</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>

<span class="c1"># dazl v7.5 or later, new API</span>
<span class="kn">import</span> <span class="nn">asyncio</span><span class="o">,</span> <span class="nn">dazl</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
   <span class="k">async</span> <span class="k">with</span> <span class="n">dazl</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;http://localhost:6865&quot;</span><span class="p">,</span> <span class="s2">&quot;Alice&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
      <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;Some:Request&quot;</span><span class="p">):</span>
         <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">exercise</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;Accept&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>A multi-party example. Note that because there is no more <code class="docutils literal notranslate"><span class="pre">Network</span></code> to tie connections together,
there are no guarantees that <code class="docutils literal notranslate"><span class="pre">Alice</span></code> and <code class="docutils literal notranslate"><span class="pre">Bob</span></code> receive events at around the same time. You
should generally</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># dazl v5-v7</span>
<span class="kn">import</span> <span class="nn">dazl</span>

<span class="n">network</span> <span class="o">=</span> <span class="n">dazl</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span>
<span class="n">network</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost:6865&quot;</span><span class="p">)</span>

<span class="n">client_alice</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">aio_party</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>
<span class="n">client_bob</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">aio_party</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">)</span>

<span class="nd">@client_alice</span><span class="o">.</span><span class="n">on_ledger_create</span><span class="p">(</span><span class="s2">&quot;Some:Request&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">auto_accept</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">dazl</span><span class="o">.</span><span class="n">exercise</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;Accept&quot;</span><span class="p">)</span>

<span class="nd">@client_bob</span><span class="o">.</span><span class="n">on_ledger_create</span><span class="p">(</span><span class="s2">&quot;Some:Request&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">auto_accept</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">dazl</span><span class="o">.</span><span class="n">exercise</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;Accept&quot;</span><span class="p">))</span>

<span class="n">network</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1"># dazl v7.5 or later, transitional API</span>
<span class="kn">import</span> <span class="nn">dazl</span>

<span class="n">network</span> <span class="o">=</span> <span class="n">dazl</span><span class="o">.</span><span class="n">ConnectionFactory</span><span class="p">()</span>
<span class="n">network</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://localhost:6865&quot;</span><span class="p">)</span>

<span class="n">client_alice</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">aio_party</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>
<span class="n">client_bob</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">aio_party</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">)</span>

<span class="nd">@client_alice</span><span class="o">.</span><span class="n">on_ledger_create</span><span class="p">(</span><span class="s2">&quot;Some:Request&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">auto_accept</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
   <span class="c1"># changed to avoid warnings, even though it still works the old way</span>
   <span class="c1"># return dazl.exercise(event.cid, &quot;Accept&quot;)</span>
   <span class="k">return</span> <span class="n">client_alice</span><span class="o">.</span><span class="n">submit_exercise</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;Accept&quot;</span><span class="p">)</span>

<span class="nd">@client_bob</span><span class="o">.</span><span class="n">on_ledger_create</span><span class="p">(</span><span class="s2">&quot;Some:Request&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">auto_accept</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
   <span class="c1"># changed to avoid warnings, even though it still works the old way</span>
   <span class="c1"># return dazl.exercise(event.cid, &quot;Accept&quot;))</span>
   <span class="k">return</span> <span class="n">client_bob</span><span class="o">.</span><span class="n">submit_exercise</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;Accept&quot;</span><span class="p">)</span>

<span class="n">network</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1"># dazl v7.5 or later, new API</span>
<span class="kn">import</span> <span class="nn">asyncio</span><span class="o">,</span> <span class="nn">dazl</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main_alice</span><span class="p">():</span>
   <span class="k">async</span> <span class="k">with</span> <span class="n">dazl</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;http://localhost:6865&quot;</span><span class="p">,</span> <span class="s2">&quot;Alice&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
      <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;Some:Request&quot;</span><span class="p">):</span>
         <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">exercise</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;Accept&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main_bob</span><span class="p">():</span>
   <span class="k">async</span> <span class="k">with</span> <span class="n">dazl</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;http://localhost:6865&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
      <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;Some:Request&quot;</span><span class="p">):</span>
         <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">exercise</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="s2">&quot;Accept&quot;</span><span class="p">)</span>

<span class="c1"># Python 3.7+</span>
<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">main_alice</span><span class="p">(),</span> <span class="n">main_bob</span><span class="p">()))</span>
</pre></div>
</div>
</section>
<section id="command-line-changes">
<h3>Command-line changes<a class="headerlink" href="#command-line-changes" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>The standard set of command line options provided by <code class="docutils literal notranslate"><span class="pre">dazl.run</span></code> has changed. This also impacts any</dt><dd><p>Daml Python bindings commands (<code class="docutils literal notranslate"><span class="pre">dazl</span> <span class="pre">ls</span></code>, <code class="docutils literal notranslate"><span class="pre">dazl</span> <span class="pre">tail</span></code>, etc.) as well as any custom commands that use</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">dazl.run</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-p</span></code> is now used to denote the Ledger API port and <strong>not</strong> <code class="docutils literal notranslate"><span class="pre">Party</span></code>. In the Daml Python bindings v8,
supplying a string argument to <code class="docutils literal notranslate"><span class="pre">-p</span></code> will be still interpreted as a <code class="docutils literal notranslate"><span class="pre">Party</span></code> but you will get a warning;
switch to <code class="docutils literal notranslate"><span class="pre">--act-as</span></code> or <code class="docutils literal notranslate"><span class="pre">--read-as</span></code> instead. This backwards compatible behavior will be
removed in the Daml Python bindings v9.0.0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--party</span></code>/<code class="docutils literal notranslate"><span class="pre">--parties</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">--act-as</span></code> (<code class="docutils literal notranslate"><span class="pre">-u</span></code>); <code class="docutils literal notranslate"><span class="pre">--party-groups</span></code> has been
renamed to <code class="docutils literal notranslate"><span class="pre">--read-as</span></code> (<code class="docutils literal notranslate"><span class="pre">-r</span></code>). Both <code class="docutils literal notranslate"><span class="pre">--act-as</span></code> and <code class="docutils literal notranslate"><span class="pre">--read-as</span></code> take a comma-separated list
of parties, or as an alternative can be specified multiple times. This matches the terminology
used in multi-party submissions as added in Daml Connect 1.9. The older forms of these flags will
be removed in the Daml Python bindings v9.0.0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--package-fetch-poll-interval</span></code> replaces <code class="docutils literal notranslate"><span class="pre">--eager-package-fetch</span></code>.
If unspecified or zero, package polling is disabled. Note that the Daml Python bindings will still generally
discover packages as it needs to. This is really only of value if you are explicitly interested
in keeping metadata up-to-date because you are using package metadata, and you should generally
NOT use this for performance reasons.</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">-eager-package-fetch</span></code> is the same as specifying <code class="docutils literal notranslate"><span class="pre">--package-fetch-poll-interval=1</span></code>,
as the Daml Python bindings previously polled for package updates once a second.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--enable-http-proxy</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">--use-http-proxy</span></code>; the old flag will be removed in
the Daml Python bindings v9.0.0.</p></li>
<li><dl class="simple">
<dt>The following flags have no effect in the Daml Python bindings v8 and will be removed in the Daml Python bindings v8.0.0::</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--idle-timeout</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--max-command-batch-timeout</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--max-connection-batch-size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--max-connection-count</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--max-consequence-depth</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--max-event-block-size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--poll-interval</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--quiet-count</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--use-acs-service</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="migrating-to-the-daml-python-bindings-v7">
<h2>Migrating to the Daml Python bindings v7<a class="headerlink" href="#migrating-to-the-daml-python-bindings-v7" title="Permalink to this headline">¶</a></h2>
<section id="template-formats">
<h3>Template formats<a class="headerlink" href="#template-formats" title="Permalink to this headline">¶</a></h3>
<p>Versions of the Daml Python bindings prior to version 7 understood previously-used conventions for template names
other than the form <code class="docutils literal notranslate"><span class="pre">package_ref:module_name:entity_name</span></code>. As of version 7, this is the only
understood format, and other forms are now unrecognized.</p>
<p>Concretely, this will mean you need to change code usages such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@client</span><span class="o">.</span><span class="n">ledger_create</span><span class="p">(</span><span class="s1">&#39;MyModule.MyTemplate&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_something</span><span class="p">(</span><span class="n">event</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@client</span><span class="o">.</span><span class="n">ledger_create</span><span class="p">(</span><span class="s1">&#39;MyModule:MyTemplate&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_something</span><span class="p">(</span><span class="n">event</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="sandbox-wrapper">
<h3>Sandbox Wrapper<a class="headerlink" href="#sandbox-wrapper" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">dazl.sandbox()</span></code> function has been removed. In order to set up tests around applications that
use the Daml Python bindings as a library, see the testing guide.</p>
</section>
<section id="time-model-changes">
<h3>Time Model changes<a class="headerlink" href="#time-model-changes" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/digital-asset/daml/releases/tag/v1.0.0">DAML SDK 1.0</a> brought some changes to
the way that time works over the Ledger API. Clients no longer need to behave differently for
ledgers that run in static time vs. real time mode.</p>
<p>The default time model for the DAML SDK Sandbox has changed to real time. Consequently, the Daml Python bindings
APIs for manipulating static time have been removed and no replacement API is available. Static time
is generally only useful in non-production contexts and use cases that require static time are
better addressed with DAML scenarios.</p>
</section>
<section id="deprecated-symbols-removal">
<h3>Deprecated symbols removal<a class="headerlink" href="#deprecated-symbols-removal" title="Permalink to this headline">¶</a></h3>
<p>Deprecated symbols in the <cite>dazl.damlast</cite> and <cite>dazl.model</cite> packages have been removed:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Removed symbol</p></th>
<th class="head"><p>Replacement</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.damlast.daml_lf_1.ModuleRef.package_id</span></code> property</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">dazl.damlast.util.package_ref()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.damlast.daml_lf_1.ModuleRef.module_name</span></code> property</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">dazl.damlast.util.module_name()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.damlast.daml_lf_1.TypeConName.module</span></code> property</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">dazl.damlast.util.module_ref()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.damlast.daml_lf_1.TypeConName.name</span></code> property</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">dazl.damlast.util.module_local_name()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.damlast.daml_lf_1.TypeConName.full_name</span></code> property</p></td>
<td><p>no replacement</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.damlast.daml_lf_1.TypeConName.full_name_unambiguous</span></code> property</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">dazl.damlast.util.package_local_name()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.model.types.TypeReference.module</span></code> property</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">dazl.damlast.util.module_ref()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.model.types.TypeReference.name</span></code> property</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">dazl.damlast.util.module_local_name()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.model.types.TypeReference.full_name</span></code> property</p></td>
<td><p>no replacement</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dazl.model.types.TypeReference.full_name_unambiguous</span></code> property</p></td>
<td><p><code class="xref py py-func docutils literal notranslate"><span class="pre">dazl.damlast.util.package_local_name()</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="migrating-to-v6">
<h2>Migrating to v6<a class="headerlink" href="#migrating-to-v6" title="Permalink to this headline">¶</a></h2>
<p>No major breaking API changes were introduced in the v6 release.</p>
</section>
<section id="migrating-to-v5">
<h2>Migrating to v5<a class="headerlink" href="#migrating-to-v5" title="Permalink to this headline">¶</a></h2>
<section id="library-initialization">
<h3>Library Initialization<a class="headerlink" href="#library-initialization" title="Permalink to this headline">¶</a></h3>
<p>Old API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># original Daml Python bindings API</span>
<span class="k">with</span> <span class="n">create_client</span><span class="p">(</span><span class="n">participant_url</span><span class="o">=</span><span class="s1">&#39;http://localhost:7600&#39;</span><span class="p">,</span> <span class="n">parties</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">manager</span><span class="p">:</span>
    <span class="n">alice_client</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>
    <span class="n">bob_client</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>
    <span class="c1"># register some event handlers for Alice and Bob</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>
</pre></div>
</div>
<p>New API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># asyncio-based API</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="p">()</span>
<span class="n">network</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://localhost:7600&#39;</span><span class="p">)</span>

<span class="n">alice_client</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">aio_party</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>
<span class="n">bob_client</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">aio_party</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>

<span class="c1"># run</span>
<span class="n">alice_client</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="initialization-event-listeners">
<h3>Initialization Event Listeners<a class="headerlink" href="#initialization-event-listeners" title="Permalink to this headline">¶</a></h3>
<p>Arguments to event listeners have changed in order to provide more information about events and
for consistency across event handlers.</p>
<p>Initialization has been collapsed into a single event, where formerly, there were two events
(<code class="docutils literal notranslate"><span class="pre">on_init</span></code> and <code class="docutils literal notranslate"><span class="pre">on_init_metadata</span></code>):</p>
<p>Old API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># original Daml Python bindings API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;Some Party&#39;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">on_init</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ledger initialization is happening&#39;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">on_init_metadata</span><span class="p">(</span><span class="k">lambda</span> <span class="n">store</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ledger package store: </span><span class="si">{</span><span class="n">store</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>New API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># asyncio-based API</span>
<span class="n">client</span><span class="o">.</span><span class="n">add_ledger_init</span><span class="p">(</span><span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ledger initialization with package store: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">store</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="ready-event-listeners">
<h3>Ready Event Listeners<a class="headerlink" href="#ready-event-listeners" title="Permalink to this headline">¶</a></h3>
<p>Old API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># original Daml Python bindings API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;Some Party&#39;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">on_ready</span><span class="p">(</span><span class="k">lambda</span> <span class="n">party_name</span><span class="p">,</span> <span class="n">client</span>\<span class="n">_</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Party </span><span class="si">{</span><span class="n">party_name</span><span class="si">}</span><span class="s1"> is ready&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>New API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># asyncio-based API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">aio_party</span><span class="p">(</span><span class="s1">&#39;Some Party&#39;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">add_ledger_ready</span><span class="p">(</span><span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Party </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">party</span><span class="si">}</span><span class="s1"> is ready&#39;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="create-archive-event-listeners">
<h3>Create/Archive Event Listeners<a class="headerlink" href="#create-archive-event-listeners" title="Permalink to this headline">¶</a></h3>
<p>Create and archive events now take a single parameter, called <code class="docutils literal notranslate"><span class="pre">event</span></code> by convention, that contain
the contract ID, contract data, and additional metadata about the event, such as the time of
execution, ledger ID, and access to the active contract set.</p>
<p>Old API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># original Daml Python bindings API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;Some Party&#39;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">on_created</span><span class="p">(</span><span class="s1">&#39;Some.Asset&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">cid</span><span class="p">,</span> <span class="n">cdata</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">cdata</span><span class="p">))</span>
<span class="n">client</span><span class="o">.</span><span class="n">on_archived</span><span class="p">(</span><span class="s1">&#39;Some.Asset&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">cid</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span>
</pre></div>
</div>
<p>New API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># asyncio-based API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">aio_party</span><span class="p">(</span><span class="s1">&#39;Some Party&#39;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">add_ledger_created</span><span class="p">(</span><span class="s1">&#39;Some.Asset&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">cdata</span><span class="p">))</span>
<span class="n">client</span><span class="o">.</span><span class="n">add_ledger_archived</span><span class="p">(</span><span class="s1">&#39;Some.Asset&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">cid</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
</section>


  </main>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'',
            VERSION:'7.11.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/documentation_options.js"></script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <footer> 
  </footer>
</body>
</html>